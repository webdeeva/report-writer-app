{% extends "base.html" %}

{% block styles %}
<style>
  @page {
    size: letter;  /* 8.5 x 11 inches */
    margin: 1cm;
  }
  
  .relationship-report-header {
    background-color: #f9f9f9;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
  }
  
  .cover-page {
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: center;
    text-align: center;
  }
  
  .cover-title {
    margin-top: 2cm;
  }
  
  .report-logo {
    width: 150px;
    margin-bottom: 20px;
    display: block;
    margin-left: auto;
    margin-right: auto;
  }
  
  .person-section {
    background-color: #f5f5f5;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
  }
  
  .person-header {
    border-bottom: 1px solid #ddd;
    padding-bottom: 10px;
    margin-bottom: 15px;
  }
  
  .combination-section {
    background-color: #f0f0f0;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    text-align: center;
  }
  
  .card-description {
    margin-top: 15px;
    text-align: left;
  }
  
  .card-meaning {
    font-style: italic;
    color: #555;
  }
  
  .page-break {
    page-break-after: always;
  }
  
  .spread-page {
    margin-top: 1cm;
    margin-bottom: 1cm;
  }
  
  .card-divider {
    text-align: center;
    margin: 50px 0;
    font-size: 24px;
    color: #800000;
  }
  
  /* Date display styles */
  .date-display {
    font-size: 16px;
    font-weight: bold;
    color: #333;
    background-color: #f9f9f9;
    padding: 8px 15px;
    border-radius: 4px;
    border: 1px solid #ddd;
    display: inline-block;
    margin: 10px 0;
  }
  
  /* Footer styles */
  .footer-content {
    font-size: 14px;
    font-weight: bold;
    color: #333;
    padding: 5px 0;
    border-top: 1px solid #ddd;
  }
  
  /* Markdown styles */
  .analysis-content h1 {
    font-size: 24px;
    font-weight: bold;
    margin-top: 20px;
    margin-bottom: 10px;
  }
  
  .analysis-content h2 {
    font-size: 20px;
    font-weight: bold;
    margin-top: 15px;
    margin-bottom: 8px;
  }
  
  .analysis-content h3 {
    font-size: 18px;
    font-weight: bold;
    margin-top: 12px;
    margin-bottom: 6px;
  }
  
  .analysis-content p {
    margin-bottom: 10px;
  }
  
  .analysis-content ul {
    margin-left: 20px;
    margin-bottom: 10px;
  }
  
  .analysis-content li {
    margin-bottom: 5px;
    list-style-type: disc;
  }
  
  .analysis-content strong {
    font-weight: bold;
  }
  
  .analysis-content em {
    font-style: italic;
  }
  
  /* Card spread styles */
  .spread-container {
    background-color: #f0f0f0;
    padding: 20px;
    border-radius: 8px;
    margin: 20px 0;
  }
  
  .card-row {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
  }
  
  .card-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0 10px;
    width: 100px;
  }
  
  .card-placement {
    font-size: 12px;
    text-align: center;
    margin-top: 5px;
    font-weight: bold;
  }
  
  .card-placement-description {
    font-size: 10px;
    text-align: center;
    margin-top: 3px;
    color: #555;
    max-width: 100px;
  }
  
  /* Positions explanation styles */
  .positions-explanation {
    margin-top: 20px;
  }
  
  .position-item {
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 1px solid #eee;
  }
  
  .position-item h3 {
    color: #800000;
    font-size: 18px;
    margin-bottom: 8px;
  }
  
  .position-item p {
    margin-bottom: 0;
  }
</style>
{% endblock %}

{% block content %}
  <!-- Cover Page with Relationship Information -->
  <div class="cover-page">
    <div class="cover-title">
      {% if custom_logo %}
        <img src="{{ custom_logo }}" alt="Custom Logo" class="report-logo">
      {% else %}
        <img src="logo.png" alt="Report Writer Logo" class="report-logo">
      {% endif %}
      <h2 class="text-center">Relationship Analysis</h2>
      <h3 class="text-center">{{ person1_name }} & {{ person2_name }}</h3>
    </div>
    
    <div class="card-divider">♥ ♣ ♦ ♠ ♥ ♣ ♦ ♠ ♥ ♣ ♦ ♠</div>
    
    <div class="cover-footer">
      {% if custom_footer %}
        <div class="custom-footer">
          {{ custom_footer | markdown | safe }}
        </div>
      {% else %}
        <div class="date-display">Generated on {{ generated_date | formatDate }}</div>
        <p>Report Writer</p>
      {% endif %}
    </div>
  </div>
  
  <!-- Page Break -->
  <div class="page-break"></div>
  
  <!-- Birth Cards and POV Cards Page -->
  <div class="section">
    <h2 class="text-center">Birth Cards & POV Cards</h2>
    
    <!-- Person 1 -->
    <div class="person-section">
      <div class="person-header">
        <h3>{{ person1_name | default('Person 1') }}</h3>
        <p>Birth Date: {{ person1_birthdate | default('N/A') }}</p>
      </div>
      
      <h4>Birth Card</h4>
      <div class="card-container">
        {% for card in person1_cards %}
          <div class="card {{ card.suit|lower }}">
            <div class="card-top-left">{{ card.value }}</div>
            <div class="card-center">{{ card.symbol }}</div>
            <div class="card-bottom-right">{{ card.value }}</div>
          </div>
        {% endfor %}
      </div>
      
      <h4>POV Card</h4>
      <div class="card-container">
        <div class="card {{ person1_pov_card.suit|lower }}">
          <div class="card-top-left">{{ person1_pov_card.value }}</div>
          <div class="card-center">{{ person1_pov_card.symbol }}</div>
          <div class="card-bottom-right">{{ person1_pov_card.value }}</div>
        </div>
      </div>
    </div>
    
    <!-- Person 2 -->
    <div class="person-section">
      <div class="person-header">
        <h3>{{ person2_name | default('Person 2') }}</h3>
        <p>Birth Date: {{ person2_birthdate | default('N/A') }}</p>
      </div>
      
      <h4>Birth Card</h4>
      <div class="card-container">
        {% for card in person2_cards %}
          <div class="card {{ card.suit|lower }}">
            <div class="card-top-left">{{ card.value }}</div>
            <div class="card-center">{{ card.symbol }}</div>
            <div class="card-bottom-right">{{ card.value }}</div>
          </div>
        {% endfor %}
      </div>
      
      <h4>POV Card</h4>
      <div class="card-container">
        <div class="card {{ person2_pov_card.suit|lower }}">
          <div class="card-top-left">{{ person2_pov_card.value }}</div>
          <div class="card-center">{{ person2_pov_card.symbol }}</div>
          <div class="card-bottom-right">{{ person2_pov_card.value }}</div>
        </div>
      </div>
    </div>
    
    <!-- Combination Card -->
    <div class="combination-section">
      <h3>Combination Card</h3>
      <div class="card-container">
        <div class="card {{ combination_card.suit|lower }}">
          <div class="card-top-left">{{ combination_card.value }}</div>
          <div class="card-center">{{ combination_card.symbol }}</div>
          <div class="card-bottom-right">{{ combination_card.value }}</div>
        </div>
      </div>
      
      <div class="card-description">
        <p>{{ combination_card_description | default('No description available for this combination card.') }}</p>
      </div>
    </div>
  </div>
  
  <!-- Page Break -->
  <div class="page-break"></div>
  
  <!-- Spread Page -->
  <div class="spread-page">
    <h2 class="text-center">Combination Card Spread</h2>
    <p class="text-center">This spread represents the 13 cards starting from the combination card's position.</p>
    
    <div class="spread-container">
      <!-- First row: 5 cards (Sun, Mercury, Venus, Mars, Jupiter) -->
      <div class="card-row">
        {% for i in range(5) %}
          {% if i < spread_with_positions|length %}
            {% set position = spread_with_positions[i] %}
            <div class="card-wrapper">
              <div class="card {{ position.card.suit|lower }}">
                <div class="card-top-left">{{ position.card.value }}</div>
                <div class="card-center">{{ position.card.symbol }}</div>
                <div class="card-bottom-right">{{ position.card.value }}</div>
              </div>
              <div class="card-placement">{{ position.position }}</div>
              <div class="card-placement-description">
                {% if position.position == "Sun" %}
                  The core energy of the relationship
                {% elif position.position == "Mercury" %}
                  Communication within the relationship
                {% elif position.position == "Venus" %}
                  Love and affection in the relationship
                {% elif position.position == "Mars" %}
                  Passion and drive in the relationship
                {% elif position.position == "Jupiter" %}
                  Growth and expansion in the relationship
                {% endif %}
              </div>
            </div>
          {% else %}
            <div class="card-wrapper">
              <div class="card">
                <div class="card-center">?</div>
              </div>
              <div class="card-placement">
                {% if i == 0 %}Sun{% elif i == 1 %}Mercury{% elif i == 2 %}Venus{% elif i == 3 %}Mars{% elif i == 4 %}Jupiter{% endif %}
              </div>
              <div class="card-placement-description">
                {% if i == 0 %}
                  The core energy of the relationship
                {% elif i == 1 %}
                  Communication within the relationship
                {% elif i == 2 %}
                  Love and affection in the relationship
                {% elif i == 3 %}
                  Passion and drive in the relationship
                {% elif i == 4 %}
                  Growth and expansion in the relationship
                {% endif %}
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
      
      <!-- Second row: 5 cards (Saturn, Uranus, Neptune, Pluto, Result) -->
      <div class="card-row">
        {% for i in range(5, 10) %}
          {% if i < spread_with_positions|length %}
            {% set position = spread_with_positions[i] %}
            <div class="card-wrapper">
              <div class="card {{ position.card.suit|lower }}">
                <div class="card-top-left">{{ position.card.value }}</div>
                <div class="card-center">{{ position.card.symbol }}</div>
                <div class="card-bottom-right">{{ position.card.value }}</div>
              </div>
              <div class="card-placement">{{ position.position }}</div>
              <div class="card-placement-description">
                {% if position.position == "Saturn" %}
                  Responsibilities and challenges in the relationship
                {% elif position.position == "Uranus" %}
                  Unexpected changes and innovations in the relationship
                {% elif position.position == "Neptune" %}
                  Dreams and ideals in the relationship
                {% elif position.position == "Pluto" %}
                  Transformation and power dynamics in the relationship
                {% elif position.position == "Result" %}
                  The rewarding energy that results from overcoming the challenges
                {% endif %}
              </div>
            </div>
          {% else %}
            <div class="card-wrapper">
              <div class="card">
                <div class="card-center">?</div>
              </div>
              <div class="card-placement">
                {% if i == 5 %}Saturn{% elif i == 6 %}Uranus{% elif i == 7 %}Neptune{% elif i == 8 %}Pluto{% elif i == 9 %}Result{% endif %}
              </div>
              <div class="card-placement-description">
                {% if i == 5 %}
                  Responsibilities and challenges in the relationship
                {% elif i == 6 %}
                  Unexpected changes and innovations in the relationship
                {% elif i == 7 %}
                  Dreams and ideals in the relationship
                {% elif i == 8 %}
                  Transformation and power dynamics in the relationship
                {% elif i == 9 %}
                  The rewarding energy that results from overcoming the challenges
                {% endif %}
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
      
      <!-- Third row: 3 cards (Peak, Moon, Earth/Transformation) -->
      <div class="card-row">
        {% for i in range(10, 13) %}
          {% if i < spread_with_positions|length %}
            {% set position = spread_with_positions[i] %}
            <div class="card-wrapper">
              <div class="card {{ position.card.suit|lower }}">
                <div class="card-top-left">{{ position.card.value }}</div>
                <div class="card-center">{{ position.card.symbol }}</div>
                <div class="card-bottom-right">{{ position.card.value }}</div>
              </div>
              <div class="card-placement">{{ position.position }}</div>
              <div class="card-placement-description">
                {% if position.position == "Peak" %}
                  The crowning glory of the relationship
                {% elif position.position == "Moon" %}
                  Emotional needs and intuition in the relationship
                {% elif position.position == "Earth/Transformation" %}
                  The card the relationship ultimately transforms into over time
                {% endif %}
              </div>
            </div>
          {% else %}
            <div class="card-wrapper">
              <div class="card">
                <div class="card-center">?</div>
              </div>
              <div class="card-placement">
                {% if i == 10 %}Peak{% elif i == 11 %}Moon{% elif i == 12 %}Earth/Transformation{% endif %}
              </div>
              <div class="card-placement-description">
                {% if i == 10 %}
                  The crowning glory of the relationship
                {% elif i == 11 %}
                  Emotional needs and intuition in the relationship
                {% elif i == 12 %}
                  The card the relationship ultimately transforms into over time
                {% endif %}
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
    
    <div class="card-divider">♥♣♦♠♥♣♦♠♥♣♦♠♥♣♦♠</div>
  </div>
  
  <!-- Page Break -->
  <div class="page-break"></div>
  
  <!-- Card Positions Explanation Page -->
  <div class="section">
    <h2 class="text-center">Understanding Card Positions</h2>
    <p>Each position in the relationship spread represents a different area of influence in your relationship. Understanding these positions provides context for interpreting the cards that appear in them.</p>
    
    <div class="positions-explanation">
      <div class="position-item">
        <h3>Sun</h3>
        <p>The Sun placement represents the core energy of the relationship. It illuminates the primary focus and central theme that drives your interactions. This card reveals how the relationship expresses itself and where its life force is directed.</p>
      </div>
      
      <div class="position-item">
        <h3>Mercury</h3>
        <p>The Mercury placement governs communication within the relationship. It influences how you process information together, express ideas to each other, and connect through words and thoughts. This card reveals the mental themes and communication style that are prominent in your relationship.</p>
      </div>
      
      <div class="position-item">
        <h3>Venus</h3>
        <p>The Venus placement shapes the love and affection in your relationship. It influences your approach to harmony, shared values, and what you find beautiful or pleasurable together. This card reveals how you connect emotionally and what you're drawn to or appreciate as a couple.</p>
      </div>
      
      <div class="position-item">
        <h3>Mars</h3>
        <p>The Mars placement determines the passion and drive in your relationship. It influences your shared energy levels, how you pursue goals together, and your approach to challenges. This card reveals how you take action as a couple and handle conflicts or competitive situations.</p>
      </div>
      
      <div class="position-item">
        <h3>Jupiter</h3>
        <p>The Jupiter placement brings expansion and growth to your relationship. It influences areas where you'll experience abundance, learning, and positive development together. This card reveals where you might receive blessings, gain wisdom, or experience fortunate circumstances as a couple.</p>
      </div>
      
      <div class="position-item">
        <h3>Saturn</h3>
        <p>The Saturn placement presents responsibilities and challenges in your relationship. It influences where you'll need to establish boundaries, create structure, or face limitations together. This card reveals challenges that will ultimately strengthen your bond through patience and perseverance.</p>
      </div>
      
      <div class="position-item">
        <h3>Uranus</h3>
        <p>The Uranus placement brings unexpected changes and innovations to your relationship. It influences areas where you'll experience breakthroughs, disruptions, or sudden insights together. This card reveals where you might break free from old patterns, embrace originality, or encounter surprising developments as a couple.</p>
      </div>
      
      <div class="position-item">
        <h3>Neptune</h3>
        <p>The Neptune placement affects the dreams and ideals in your relationship. It influences areas where boundaries dissolve, imagination flourishes, or confusion might arise between you. This card reveals where you'll connect with the intangible, experience compassion, or need to distinguish between illusion and reality together.</p>
      </div>
      
      <div class="position-item">
        <h3>Pluto</h3>
        <p>The Pluto placement triggers transformation and power dynamics in your relationship. It influences areas where you'll experience powerful change, regeneration, or the surfacing of subconscious material together. This card reveals where deep healing can occur through releasing what no longer serves your relationship.</p>
      </div>
      
      <div class="position-item">
        <h3>Result</h3>
        <p>The Result placement shows the outcome of navigating the Pluto card's transformative energy. It represents what emerges after embracing change and doing the necessary work together. This card reveals the rewards or new state of being that becomes possible through transformation in your relationship.</p>
      </div>
      
      <div class="position-item">
        <h3>Peak</h3>
        <p>The Peak placement represents the highest potential or achievement possible in your relationship. It shows the culmination of your efforts together and the pinnacle experience available to you as a couple. This card reveals what you can aspire to and the crowning glory of your relationship.</p>
      </div>
      
      <div class="position-item">
        <h3>Moon</h3>
        <p>The Moon placement reflects the emotional landscape and intuitive connection in your relationship. It influences your shared feelings and inner world. This card reveals the emotional themes of your relationship and how you process experiences together on a feeling level.</p>
      </div>
      
      <div class="position-item">
        <h3>Earth/Transformation</h3>
        <p>The Earth/Transformation placement represents the grounding force and practical manifestation of all other energies in your relationship. It shows how your relationship's lessons will be integrated in tangible ways. This card reveals the ultimate transformation that occurs when all other energies are harmonized and embodied in your relationship.</p>
      </div>
    </div>
  </div>
  
  <!-- Page Break -->
  <div class="page-break"></div>
  
  <!-- Analysis Content -->
  <div class="section">
    <h2>Analysis</h2>
    <div class="analysis-content">
      {% if content %}
        {{ content | markdown | safe }}
      {% else %}
        <p>No analysis content is available for this relationship report. This could be due to an error in the content generation process.</p>
      {% endif %}
    </div>
  </div>
{% endblock %}

{% block footer %}
  <div class="footer-content">
    <div class="date-display">Generated on {{ generated_date | formatDate | default('Unknown Date') }}</div>
    <p>Report Writer | Relationship Report for {{ person1_name | default('Person 1') }} & {{ person2_name | default('Person 2') }}</p>
  </div>
{% endblock %}
